# 代理模式

## 代理设计模式的概念
将对某个功能的调用以及使用的代码封装起来，避免调用方式以及使用代码的直接暴露。

--- 
在代理模式中有个接口，接口中有个代理实现，要用代理实现去代表真实实现。

---
代理分为静态代理和动态代理
1. 静态代理：一个接口对应一个实现类和一个代理实现类，让代理实现类去做实现类想做的事。
2. 动态代理：一个接口只有一个实现类，没有代理实现类，在项目运行时，动态创建一个代理类来代替实现类去做某事。

---
由于某些原因需要给某对象提供一个代理以控制对该对象的访问。这时，访问对象不适合或者不能直接引用目标对象，代理对象作为访问对象和目标对象之间的中介。


--- 
根据代理的创建时期，代理模式分为静态代理和动态代理。
1. 静态：由程序员创建代理类或特定工具自动生成源代码再对其编译，在程序运行前代理类的 .class 文件就已经存在了。
2. 动态：在程序运行时，运用反射机制动态创建而成

## 代理设计模式的好处
1. 简化代码的使用流程 
2. 保护真实的方法的调用方式

## 代理模式中的角色
1. 抽象角色（接口）
2. 真实角色，真正的执行方法所在的类。
3. 代理角色，代理真实角色的类。

## 代理模式的优缺点
优点
1. 代理模式在客户端与目标对象之间起到一个中介作用和保护目标对象的作用；
2. 代理对象可以扩展目标对象的功能；
3. 代理模式能将客户端与目标对象分离，在一定程度上降低了系统的耦合度，增加了程序的可扩展性

缺点
1. 代理模式会造成系统设计中类的数量增加
2. 在客户端和目标对象之间增加一个代理对象，会造成请求处理速度变慢；
3. 增加了系统的复杂度；

## 代理模式的应用场景

当无法或不想直接引用某个对象或访问某个对象存在困难时，可以通过代理对象来间接访问。使用代理模式主要有两个目的：一是保护目标对象，二是增强目标对象。

前面分析了代理模式的结构与特点，现在来分析以下的应用场景。

1. 远程代理，这种方式通常是为了隐藏目标对象存在于不同地址空间的事实，方便客户端访问。例如，用户申请某些网盘空间时，会在用户的文件系统中建立一个虚拟的硬盘，用户访问虚拟硬盘时实际访问的是网盘空间。
2. 虚拟代理，这种方式通常用于要创建的目标对象开销很大时。例如，下载一幅很大的图像需要很长时间，因某种计算比较复杂而短时间无法完成，这时可以先用小比例的虚拟代理替换真实的对象，消除用户对服务器慢的感觉。
3. 安全代理，这种方式通常用于控制不同种类客户对真实对象的访问权限。
4. 智能指引，主要用于调用目标对象时，代理附加一些额外的处理功能。例如，增加计算真实对象的引用次数的功能，这样当该对象没有被引用时，就可以自动释放它。
5. 延迟加载，指为了提高系统的性能，延迟对目标的加载。例如，Hibernate 中就存在属性的延迟加载和关联表的延时加载。



## 静态代理相关概念
1. 真实对象：要进行功能扩展的对象
2. 真实方法：要进行功能扩展的方法
3. 代理对象：调用真实对象并完成功能扩展的对象。
4. 代理方法：调用真实方法的扩展方法。

## 静态代理的特点
代理对象和代理方法都是由程序员自己编写。

## 什么是动态代理模式

动态代理是java的一种设计模式。它的特征就是委托类和代理类具有相同的接口，代理类是在委托类的代码基础上添加了其他功能，比如消息预处理、消息过滤和事后处理消息等。但是实际上业务逻辑还是有委托类去完成的，简单来说，调用委托类的时候是通过代理对象来实现的。

代理类是在程序运行的时候创建的所以被称为动态代理。动态代理相对于静态代理更加灵活，能够根据java代码指示动态生成。

## 动态代理的特点
代理对象和代理方法是动态生成的。底层流程和静态代理一致。

## 动态代理的种类
动态代理既然代理对象和代理方法是动态生成的，为了便于用户的调用，要求代理方法和真实方法的方法名，形参，返回值必须保持一致。

具体实现如下:
1. jdk动态代理（官方提供），真实对象和代理对象实现相同的接口。
2. cglib动态代理（第三方），代理对象继承真实对象。

## SpringAOP基于jdk的动态代理

## jdk代理和CGLIB代理
使用CGLib实现动态代理，CGLib底层采用ASM字节码生成框架，使用字节码技术生成代理类，在JDK1.6之前比使用Java反射效率要高。唯一需要注意的是，CGLib不能对声明为final的类或者方法进行代理，因为CGLib原理是动态生成被代理类的子类。

在JDK1.6、JDK1.7、JDK1.8逐步对JDK动态代理优化之后，在调用次数较少的情况下，JDK代理效率高于CGLib代理效率，只有当进行大量调用的时候，JDK1.6和JDK1.7比CGLib代理效率低一点，但是到JDK1.8的时候，JDK代理效率高于CGLib代理。所以如果有接口使用JDK动态代理，如果没有接口使用CGLIB代理。

## 动态代理和静态代理
动态代理与静态代理相比较，最大的好处是接口中声明的所有方法都被转移到调用处理器一个集中的方法中处理（InvocationHandler.invoke）。这样，在接口方法数量比较多的时候，我们可以进行灵活处理，而不需要像静态代理那样每一个方法进行中转。

如果接口增加一个方法，静态代理模式除了所有实现类需要实现这个方法外，所有代理类也需要实现此方法。增加了代码维护的复杂度。而动态代理不会出现该问题
